<html>

<head>
  <meta charset="UTF-8">
  <title>Send logs to Coralogix</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="./MyLogsShipper.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fjalla+One&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:ital@1&family=Fjalla+One&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/2231ab4bab.js" crossorigin="anonymous"></script>

</head>

<!-- Start of coralogixsupport Zendesk Widget script --><script id="ze-snippet" src="https://static.zdassets.com/ekr/snippet.js?key=e8b2d690-f2f1-4fcf-a92f-d74ca8855073"> </script><!-- End of coralogixsupport Zendesk Widget script -->

<body>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>


  <div class="header">
    <h1>LOGS SHIPPER <i class="fas fa-shipping-fast"></i></h1>
  </div>
  <div class="MyForm">
    <!-- <div class="input-group input-group-sm mb-3">
      <span class="input-group-text" id="inputGroup-sizing-sm">Private Key</span>
      <input type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-sm">
    </div> -->
    <!-- <label>Enter your private key</label>
  <input type="text" id="privateKeyInput" name="inputPrivateKey" size="40 px" value=""> -->
    <div class="SelectSeverity">
      <p class="title">Select the severity of your logs:</p>
      <div class="form-check-inline leftSeverityRadios">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="severitySelector" id="debugRadio" value="Debug" checked>
          <label class="form-check-label" for="debugRadio">
            Debug
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="severitySelector" id="verboseRadio" value="Verbose">
          <label class="form-check-label" for="verboseRadio">Verbose</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="severitySelector" id="infoRadio" value="Info">
          <label class="form-check-label" for="infoRadio">
            Info
          </label>
        </div>
      </div>
      <div class="form-check-inline secondSeverityRadios">
        <div class="form-check">
          <input class="form-check-input" type="radio" name="severitySelector" id="warningRadio" value="Warning">
          <label class="form-check-label" for="warningRadio">
            Warning
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="severitySelector" id="errorRadio" value="Error">
          <label class="form-check-label" for="errorRadio">
            Error
          </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="radio" name="severitySelector" id="criticalRadio" value="Critical">
          <label class="form-check-label" for="criticalRadio">
            Critical
          </label>
        </div>
      </div>
      <div class="form-check-inline">
        <input class="form-check-input" type="radio" name="severitySelector" id="randomRadio" value="Random">
        <label class="form-check-label" for="randomRadio">
          Random
        </label>
      </div>
    </div>
    <div class="dateTimeSelection">
      <p class="title">Select historical timerange for log shipping:</p>
      <div class="fromDateTime">
        <label for="fromDate">From:</label>
        <input type="date" name="fromDate" value="">
        <input type="time" name="fromTime" value="">
      </div>
      <div class="toDateTime">
        <label for="toDate">To:</label>
        <input type="date" name="foDate" value="">
        <input type="time" name="toTime" value="">
      </div>

      <div class="selectBox">
        <p class="title">OR</p>
        <div class="form-floating">
          <select class="form-select" id="floatingSelect" aria-label="Floating label select example">
            <option selected>Last 1 min</option>
            <option value="1">Last 5 min</option>
            <option value="2">Last 15 min</option>
            <option value="3">Last 30 min</option>
          </select>
          <label for="floatingSelect">Quick selection</label>
        </div>
      </div>
    </div>
    <div class="configArea">
      <p class="title">Configurations:</p>
      <div class="configSelectors">
        <div class="input-group inputGroup_appAndServiceName">
          <span class="input-group-text">Application and Subsystem name</span>
          <input type="text" aria-label="First name" class="form-control" id="appNameInput" placeholder="Application name">
          <input type="text" aria-label="Last name" class="form-control" id="subsystemNameInput" placeholder="Subsystem name">
        </div>
        <div class="input-group mb-3">
          <label class="input-group-text" for="domainSelectionDropbox">Options</label>
          <select class="form-select" id="domainSelectionDropbox">
            <option value="1" selected>coralogix.com</option>
            <option value="2">coralogix.us</option>
            <option value="3">app.coralogix.in</option>
            <option value="4">app.coralogix.eu2</option>
           <option value="5">app.coralogix.net</option>
          </select>
        </div>
      </div>

      <!-- <div class="input-group mb-3">
  <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">Domain</button>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" href="#">coralogix.com</a></li>
    <li><a class="dropdown-item" href="#">coralogix.us</a></li>
    <li><a class="dropdown-item" href="#">app.coralogix.in</a></li>
    <li><a class="dropdown-item" href="#">app.coralogix.eu2</a></li>
    <li><a class="dropdown-item" href="#">app.coralogix.net</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="#">Separated link</a></li>
  </ul>
  <input type="text" class="form-control" aria-label="Text input with dropdown button">
</div> -->
    </div>
    <div class="logsInputArea">
      <p class="title">Add logs and ship:</p>
      <div class="input-group flex-wrap dynamicJsonValue">
        <span class="input-group-text textBox">Enter log message</span>
        <textarea class="form-control" aria-label="With textarea" id="logMessageInput"></textarea>
      </div>
      <!-- Switches Area -->
      <div class="form-check form-switch isJsonSwitch">
        <input class="form-check-input" type="checkbox" role="switch" id="isJsonLogSwitch" onclick="toggleTimeRange()">
        <label class="form-check-label" for="IsJsonLogSwitch">Send multiple times</label>
      </div>
      <div class="numOfLogsRange" id="numOfLogsToShipSection">
        <p>
          <label for="ShippingTimesRange" class="form-label timesOfShippingLabel">Times of shipping this log: </label>
          <label for="ShippingTimesRange" class="form-label timesOfShippingLabel_num" id="numOfLogsToSendLabel">1</label>
          <input type="range" class="form-range" id="ShippingTimesRange" min="1" max="1000" value="1" onchange="showRangeValue(this.value)">

        </p>

      </div>
      <div class="form-check form-switch dynamicLogsSwitch">
        <input class="form-check-input" type="checkbox" role="switch" id="dynamicLogsSwitch" onclick="toggleJsonKeyInput()">
        <label class="form-check-label" for="dynamicLogsSwitch">Send logs dynamically</label>
      </div>
      <div class="inputDynamicJsonEntey" id="inputDynamicJsonEntey">
        <form class="form-floating">
          <input type="email" class="form-control" id="floatingInputValue" placeholder="name@example.com" value="Name / ip_addr ...">
          <label for="floatingInputValue">Type a JSON Key for a dinamic log</label>
        </form>
      </div>
      <!-- End of Switches area -->


    </div>
    <div class="input-group">
      <input type="text" id="privateKeyInput" class="form-control privateKeyInput" placeholder="Enter Private Key" aria-label="Recipient's username" aria-describedby="button-addon2">
      <button class="btn btn-primary btn-outline-secondary submitButton" type="button" id="submitButton" onclick="shipLogs()" name="button">SHIP IT AWAY</button>

    </div>
    <!-- <button type="button" class="btn btn-outline-primary" onclick="shipLogs()" name="button">Ship my logs</button> -->
  </div>
</body>

<script>
  //document.write(severitySelection[1].value);

  //document.write("Start sending logs \r\n");

  //alert("Private Key:" + PrivateKey + "  ");
  //alert("Application Name:" + ApplicationName + "  ");
  //alert("SubsystemName:" + SubsystemName + "  ");
  //alert("Current Time:" + CurrentTime.getTime());
  //var EntryPrivateKey="fe8ee37d-203d-51e5-9e41-8830271c2df3";





  function shipLogs() {

    // var name = "Mor";
    // var Age = 27;
    // prompt("Type of Age: " + typeof(Age) + "Type of name: " + typeof(name));

    var severitySelection = document.getElementsByName('severitySelector');
    const text = JSON.parse(document.getElementById("logMessageInput").value);


    var ActionIndex = 0;
    var dif = 0;
    var BaseWait = 0;
    var ElapsedWait = 0;
    var CurrentDate = new Date();
    var CurrentTime = 1;
    var severity = 1;
    var isDynamicLogSend = false;



    //Playground
    //document.write(CurrentDate);
    var isJsonLog = document.getElementById("isJsonLogSwitch").checked;
    //var SystemUserDataset = setUpFirstLogText(isJsonLog, text);
    var length = severitySelection.length;

    for (var i = 0; i < length; i++) {
      //document.write(severitySelection[i].value);
      //prompt(i);

      if (severitySelection[i].checked) {
        if (i === 6) {
          severity = Math.floor((Math.random() * 6) + 1);
          break;
        } else {
          severity = i + 1;
          break;
        }
      }
    }

    var MyLogPost = buildLogPost(severity)



    // MyLogPost[logEntries]["test"] = "Moran";
    // prompt(MyLogPost.logEntries[3].test);


    //Getting the time field to current time - 10 minutes. The idea is that the
    //it will be within the last 15 minutes, so the user will see logs even if the query is last 15 minutes.

    // if(document.getElementById("floatingSelect").selectedindex)
    CurrentTime = CurrentDate.getTime();
    var selectedTimeInMiliseconds = getSelectedTimeInMioliseconds();
    MyLogPost.logEntries[0].timestamp = CurrentTime - selectedTimeInMiliseconds;

    if (document.getElementById("isJsonLogSwitch").checked) {
      var numOfBulksToSend = document.getElementById('ShippingTimesRange').value;
    } else {
      numOfBulksToSend = 1;
    }

    var timeHopsBetweenBulks = selectedTimeInMiliseconds / numOfBulksToSend;
    //In case of dynamic logs - create an array with original data
    if (document.getElementById("dynamicLogsSwitch").checked) {

      isDynamicLogSend = true;
      var SelectedKey = (document.getElementById("floatingInputValue").value).split(",");
      var originValuesArray = [];
      for (var k = 0; k < SelectedKey.length; k++) {
       originValuesArray.push(text[SelectedKey[k]]);
      }

      // text[SelectedKey[k]] = text[SelectedKey[k]] + "_" + i;

    }
    for (var i = 1; i <= numOfBulksToSend; i++) {

      MyLogPost.logEntries[0].timestamp = MyLogPost.logEntries[0].timestamp + timeHopsBetweenBulks;

      if (isDynamicLogSend) {
        for (var k = 0; k < SelectedKey.length; k++) {
         text[SelectedKey[k]] = originValuesArray[k] + "_" + i;
        }
      }


      MyLogPost.logEntries[0].text = text;
      // prompt(MyLogPost.logEntries[0].text);

      //document.write(".... \r\n");
      switch (document.getElementById("domainSelectionDropbox").value) {
        case '1': {
          var httpReferer = 'https://api.coralogix.com/api/v1/logs';
          break;
        }
        case '2': {
          var httpReferer = 'https://api.coralogix.us/api/v1/logs';
          break;
        }
        case '3': {
          var httpReferer = 'https://api.app.coralogix.in/api/v1/logs';
          break;
        }
          case '4': {
          var httpReferer = 'https://api.app.coralogix.eu2/api/v1/logs';
          break;
        }
          case '5': {
          var httpReferer = 'https://api.app.coralogix.net/api/v1/logs';
          break;
        }
      }
      //Calling Coralogix REST API
      sendAPIRequestToCoralogix(httpReferer, MyLogPost);
      //      document.getElementById("thumbsUpIcon").style.display = "none";
      //      setTimeout(() => {document.getElementById("thumbsUpIcon").style.display = "block";
      // }, 5000);

    }

    //document.write(" .................... Finished sending logs");

  }

  /*=======================================================================
                              Functions Area
  =========================================================================The */

  // function setUpFirstLogText(isJsonLog, text) {
  //
  //       //Json Log
  //   if (isJsonLog) {
  //     return text;
  //   //Unstructured Log
  //   // else {
  //   //   return JSON.stringify(text);
  //   // }
  //
  //
  //   // "crx_user_id": 12345,
  //   // "crx_error_message": "message type - 4",
  //   // "crx_error_code": 200
  //
  // }

  //Calling Coralogix REST API
  function sendAPIRequestToCoralogix(url, objectToPost) {
    
    JsonToPost = JSON.stringify(objectToPost);
    try {  
      json = JSON.parse(JsonToPost);
      body_string = JsonToPost;
} catch (e) {  
  body_string = objectToPost;  
}
    fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: body_string,
    });
  }

  function buildLogPost(severity) {

    var EntryPrivateKey = document.getElementById("privateKeyInput").value;
    var EntryApplicationName = document.getElementById("appNameInput").value;
    var EntrySubsystemName = document.getElementById("subsystemNameInput").value;


    var logEntriesJsonObj = {
      "timestamp": 1581296002357,
      "severity": severity,
      "text": " "
    };

    // logEntriesJsonObj['test'] = "Moran";
    // prompt(logEntriesJsonObj.test);
    if (!EntryApplicationName) {
      EntryApplicationName = "test_AppName";
    }

    if (!EntrySubsystemName) {
      EntrySubsystemName = "test_Service"
    }

    return log = {
      privateKey: EntryPrivateKey,
      applicationName: EntryApplicationName,
      subsystemName: EntrySubsystemName,
      logEntries: [logEntriesJsonObj]
    };
  }

  function showRangeValue(value) {
    document.getElementById("numOfLogsToSendLabel").innerHTML = value;
  }

  function getSelectedTimeInMioliseconds() {
    switch (document.getElementById("floatingSelect").selectedIndex) {
      case 0:
        return 60000;
        break;
      case 1:
        return 300000;
        break;
      case 2:
        return 900000;
        break;
      case 3:
        return 1800000;
      default:

    }
  }

  function toggleTimeRange() {

    if (document.getElementById("isJsonLogSwitch").checked) {
      document.getElementById("numOfLogsToShipSection").style.visibility = "visible";
      document.getElementById("numOfLogsToShipSection").style.position = "Relative";
    } else {
      document.getElementById("numOfLogsToShipSection").style.visibility = "hidden";
      document.getElementById("numOfLogsToShipSection").style.position = "absolute";

    }
  }

  function toggleJsonKeyInput() {

    if (document.getElementById("dynamicLogsSwitch").checked) {
      document.getElementById("inputDynamicJsonEntey").style.visibility = "visible";
      document.getElementById("inputDynamicJsonEntey").style.position = "Relative";
    } else {
      document.getElementById("inputDynamicJsonEntey").style.visibility = "hidden";
      document.getElementById("inputDynamicJsonEntey").style.position = "absolute";

    }
  }
</script>

</html>
